name: Azure Login & Resource Groups Check

on:
  workflow_dispatch:   # Executa manualmente pelo GitHub Actions

jobs:
  login-rg-check:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout do reposit√≥rio
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Login no Azure usando o segredo AZURE_CREDENTIALS
      - name: Azure Login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      # 3. Verificar subscription ativa
      - name: Verify Azure subscription
        uses: azure/CLI@v1
        with:
          azcliversion: 2.30.0
          inlineScript: |
            echo "üîé Exibindo subscription atual..."
            az account show --output table || { echo "‚ùå ERRO: Falha ao exibir a subscription. Verifique o segredo AZURE_CREDENTIALS."; exit 1; }

      # 4. Listar todos os Resource Groups
      - name: List Resource Groups
        uses: azure/CLI@v1
        with:
          azcliversion: 2.30.0
          inlineScript: |
            echo "üìÇ Listando todos os Resource Groups dispon√≠veis..."
            az group list --query "[].name" -o table || { echo "‚ùå ERRO: Falha ao listar Resource Groups. O Service Principal pode n√£o ter permiss√£o de leitura."; exit 1; }

            echo "‚úÖ Resource Groups listados com sucesso!"
